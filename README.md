# Vigilence

Vigilence is a simple command-line tool meant to ensure code quality metrics are met within codebases.

![Build status](https://travis-ci.org/belvedere-trading/vigilence.svg?branch=master)

## Quickstart

Vigilence can be installed with `pip` from the root of its source directory. The package should be uploaded to pypi soon.

```bash
pip install . --user
```

The tool has only a few options:

```bash
vigilence --help
Usage: vigilence [OPTIONS] QUALITY_REPORT

Options:
  --type [cobertura|doxygen]
  --config FILENAME
  --help                      Show this message and exit.
```

The configuration file defines the constraints that should be enforced upon the codebase. The quality report contains the actual quality information for the codebase (as generated by an external code quality tool). The `--type` switch tells Vigilence what tool was used to generate the quality report (and, thus, how the configuration file should be interpreted). If a configuration file is not explicitly passed, Vigilence will look for a `vigilence.yaml` file in the current working directory.

For example, you could run Vigilence on its own code coverage report by calling the following set of command from the root of its source directory:

```bash
pip install .
python setup.py coverage
vigilence coverage.xml --type cobertura
```

If the quality enforcement succeeds, Vigilence will exit with a return code of 0; any other return code indicates a problem. A negative return code means that the tool failed while a positive code means that the quality metrics of the code base do not meet the configured constraints.

For example, the configuration for a Cobertura coverage report could look like:

```yaml
constraints:
  -
    type: global
    line: 80
    branch: 80
    complexity: 0
  -
    type: ignore
    paths:
      - vigilence/suite.py
  -
    type: file
    path: vigilence/constraint.py
    branch: 50
  -
    type: package
    name: vigilence
    branch: 75
```

This is actually the configuration file for the code coverage report of Vigilence itself. In this configuration file, each stanza contains the type of constraint that should be applied to the coverage report in addition to the metrics that should be set on each constraint. This file can be read as a set of four stanzas. In order:

1. Globally, the codebase should have a line coverage of 80%, a branch coverage of 80%, and a complexity score of 0.
2. The file `vigilence/suite.py` should be ignored entirely from coverage enforcement.
3. The file `vigilence/constraint.py` is required to have a branch coverage of only 50% (rather than the global 80%).
4. The package `vigilence` is required to have a branch coverage of only 75% (rather than the global 80%). This stanza is equivalent to setting the global branch coverage constraint to 75%, but has been included as a sort of regression test.

Configuration file format changes depending on the type of quality report being inspected. For more detail about Vigilence configuration, please see the configuration section below.

## Concepts in detail

Coming soon.

### Quality items

### Constraints

### Configuration

## Plugins

Coming soon.

### API documentation

Coming soon.
