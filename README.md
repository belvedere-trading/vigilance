# Vigilence

Vigilence is a simple command-line tool meant to ensure code quality metrics are met within codebases.

![Build status](https://travis-ci.org/belvedere-trading/vigilence.svg?branch=master)

## Quickstart

Vigilence can be installed with `pip` from the root of its source directory. The package should be uploaded to pypi soon.

```bash
pip install . --user
```

The tool has a very simple interface:

```bash
vigilence --help
Usage: vigilence [OPTIONS]

  Runs Vigilence with the specified configuration file. The default
  configuration file if no options are passed is vigilence.yaml within the
  current working directory.

Options:
  --config FILENAME  Path to the vigilence configuration file
  --help             Show this message and exit.
```

All of Vigilence's functionality is controlled by the configuration file used by the tool. The configuration file defines the quality suites that must be verified, the locations of the quality report for each suite, and the associated constraints that should be enforced upon the codebase. The quality suites are analogous to code quality tools, the quality report contains the actual quality information for the codebase (as generated by an external code quality tool), and the constraints define the metrics that a codebase must meet. If a configuration file is not explicitly passed, Vigilence will look for a `vigilence.yaml` file in the current working directory.

For example, you could run Vigilence on its own code coverage report by calling the following set of command from the root of its source directory:

```bash
pip install .
pip install -r test_required_packages.req
python setup.py coverage
vigilence
```

If the quality enforcement succeeds, Vigilence will exit with a return code of 0; any other return code indicates a problem. A negative return code means that the tool failed while a positive code means that the quality metrics of the code base do not meet the configured constraints.

The configuration for Vigilence's own quality enforcement looks like:

```yaml
suites:
  cobertura:
    report: coverage.xml
    constraints:
      -
        type: global
        line: 80
        branch: 80
        complexity: 0
      -
        type: ignore
        paths:
          - vigilence/suite.py
      -
        type: file
        path: vigilence/constraint.py
        branch: 50
      -
        type: package
        name: vigilence
        branch: 75
  doxygen:
    report: doxygen.err
    constraints:
      -
        type: documentation
```

In this configuration file, we can see that two different quality suites have been defined: "cobertura" and "doxygen". These suite names must match the name of a quality suite (either built-in or from a plugin) known to Vigilence. Each suite defines the location of its quality report (the "report" key) and the constraints that the codebase must meet. For the "cobertura" suite, there are 4 total constraints defined. In the same order that they appear in the file, these are:

1. Globally, the codebase must have a line coverage of 80%, a branch coverage of 80%, and a complexity score of 0.
2. The file `vigilence/suite.py` should be ignored entirely from coverage enforcement.
3. The file `vigilence/constraint.py` is required to have a branch coverage of only 50% (rather than the global 80%).
4. The package `vigilence` is required to have a branch coverage of only 75% (rather than the global 80%). This stanza is equivalent to setting the global branch coverage constraint to 75%, but has been included as a sort of regression test.

Configuration file format changes depending on the type of quality report being inspected. For more detail about Vigilence configuration, please see the configuration section below.

## Concepts in detail

Coming soon.

### Quality items

### Constraints

### Configuration

## Plugins

Coming soon.

### API documentation

Coming soon.
